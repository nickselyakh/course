\chapter{Параметрическое линейное программирование}\label{chap2}

Задачи математического программирования, такие как линейное, выпуклое, нелинейное программирование, помимо переменных оптимизации содержат коэффициенты --- параметры --- задающие, например, целевые функции или функциональные ограничения. Изучением влияния \textit{малых возмущений} этих параметров на решение задачи (оптимальный план, оптимальное значение целевой функции) посвящен анализ чувствительности. С другой стороны, существует ряд прикладных задач, в которых интерес представляет характеризация решения для полного диапазона значений параметров. Раздел теории математического программирования, занимающийся исследованием таких задач называется \textit{параметрическим программирование}. При этом термин параметрическое программирование относится к задачам, в которых исследуется влияние скалярного параметра, в то время как изучением задач с векторными параметрами занимается многопараметрическое программирование.

Как отмечалось во введении, многопараметрическое программирование --- основной инструмент построения оптимальных и стабилизирующих обратных связей в данной дипломной работе. В связи с этим, в настоящей главе приводятся основные определения, теоремы и алгоритмы вычисления решений в задачах многопараметрического программирования.

%Есть несколько причин для поиска эффективных решений многопараметрических программ. Как правило, математические программы подвержены неопределенности из-за факторов, которые либо неизвестны, либо будут решены позже. Параметрическое программирование систематически подразделяет пространство параметров на характерные области, которые изображают выполнимость и соответствующие характеристики в зависимости от неопределенных параметров, и, следовательно, предоставляют лицу, принимающему решение, полную карту различных результатов.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Общие положения}\label{2sec:gabella}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Первый метод решения параметрических задач линейного программирования был предложен в работе \cite{GassSaaty} в 1955 г., а затем развит в работах \cite{GalNedoma} и \cite{Bemporad}. Интерес к многопараметрическому программированию возрос с развитием теории систем и оптимального управления. Это связано с тем, что для динамических систем с дискретным временем задачи оптимального управления с ограничениями на управления и состояния и конечным горизонтом управления могут быть сформулированы как задачи математического программирования. Это будут задачи линейного или выпуклого программирования для линейных систем с линейными или выпуклыми функционалами и ограничениями или задачи нелинейного программирования. Как обсуждалось в главе 1, интерес в таких задачах представляет построение оптимальной обратной связи, как функции позиции --- пары, в общем случае, состоящей из момента времени и состояния системы в этот момент. Тогда параметром, от которого зависит критерий качества и ограничения, является позиция динамического процесса.

Используя многопараметрическое программирование, можно охарактеризовать и вычислить решение задачи оптимального управления в явном виде как функцию позиции на некотором ограниченного множестве допустимых позиций.

В теории управления по прогнозирующей модели требуется, чтобы прогнозирующая задача оптимального управления решалась  в реальном времени для вычисления текущего управляющего воздействия. Прогнозирующая задача зависит от текущего состояния объекта управления, который берется в качестве начального состояния в прогнозирующей задаче и выступает в качестве параметра. С помощью многопараметрического программирования решение в реальном времени (онлайн) может быть перенесено оффлайн, до начала процесса управления. Тогда в реальном времени все вычисления сводятся к вычислению решения задачи многопараметрического программирования для конкретного значения параметра, что значительно проще решения прогнозирующей задачи оптимального управления.



Многопараметрический анализ использует понятие критической области --- подмножества параметров задачи параметрического программирования, в котором локальные условия оптимальности остаются неизменными. В этой главе сначала приведем основные результаты нелинейного многопараметрического программирования из работы \cite{GalNedoma}, в частности, результаты, касающиеся непрерывной зависимости решений от параметров, определения невырожденности задач, понятия критической области. Затем опишем алгоритмы решения многопараметрических задач линейного программирования (mp-LP) и многопараметрических задач квадратичного программирования (mp-QP). 

Основная идея алгоритмов, представленных в этой главе, состоит в том, чтобы построить критическую область в окрестности заданного значения параметра, используя необходимые и достаточные условия оптимальности, а затем рекурсивно расширить пространство параметров за пределы этой области. Все алгоритмы чрезвычайно просты в реализации, если доступны программные реализации численных методов решения задач нелинейного программирования.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Непрерывная зависимость решений от параметров в общих многопараметрических задачах}\label{2sec:results-multy-parametric}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Рассмотрим задачу нелинейного программирования, зависящую от параметра $x$, который входит в целевую функцию и в ограничения:
\begin{align} \label{1function}
   & J^0(x) =  \min_{z} f(z,x),\\
   & g(z,x)\le 0,\nonumber
\end{align}
где $z \in M \subseteq \mathbb{R}^s$ --- переменная оптимизации, $x \in X \subseteq \mathbb{R}^n$ --- параметр,\ $f: \mathbb{R}^s\times\mathbb{R}^n \to \mathbb{R}$ --- целевая функция, а функция $g: \mathbb{R}^s\times\mathbb{R}^n \to R^{n_g}$ задает ограничения, $g_{i}(z, x)$ --- $i$-ая компонента вектор-функции $g(x, z)$.



Малые вариации параметра $x$ в задаче математического программирования (\ref{1function}) в зависимости от свойств функций $f$ и $g$ может приводить к малым вариациям оптимального решения как функции параметра $x$, но может и давать его значительные вариации. Цель последующего изложения --- установить эти вариации.

При заданном значении параметра $x$ обозначим:
\begin{itemize}
\item $R(x)$ --- допустимое множество переменных $z$ (множество планов) задачи (\ref{1function}) при фиксированном значении параметра:
\begin{equation} \label{2function}
    R(x) = \{z \in M \ |\  g(z,x) \le 0 \};
\end{equation}
\item  $K^*$ --- множество допустимых значение параметра, т. е.
\begin{equation} \label{3function}
    K^* = \{x \in \mathbb{R}^n \ |\  R(x) \not= \varnothing \};
\end{equation}

\item $J^0(x)$ --- оптимальное значение задачи (\ref{1function}): 
\begin{equation} \label{4function}
    J^0(x) = \inf_{z}\{f(z,x) \ | \ z \in R(x) \};
\end{equation}

\item $Z^0(x)$ --- множество оптимальных решений (оптимальных планов) задачи (\ref{1function}):
\begin{equation} \label{5function}
    Z^0(x) = \{ z \in R(x) \ | \ f(z,x) = J^0(x) \}.
\end{equation}
\end{itemize}

Множество $Z^0(x)$ для краткости будем называть оптимальным множеством. Если $Z^0(x)$ является одноточечным множеством для всех $x$ (задача имеет единственное решение), то $z^0(x) \triangleq Z^0(x)$ будем называть оптимальным планом. 

Будем предполагать, что $K^*$ замкнуто и $J^0(x)$ конечно при всех $x\in K^*$.

Для того, чтобы функция $J^0(x)$ и оптимальное множество $Z^0(x)$ обладали хорошими свойствами, важным будет условие непрерывности отображения $R: x\mapsto R(x) \subseteq M$. Дадим ряд определений.

%определение
\begin{definition}
    Отображение  $R(x)$ открыто в точке $\overline{x} \in K^*$, если для последовательности $\{ x^{k}\} \subset K^*,\ x^{k} \to \overline{x} $ и точки $\overline{z} \in R(\overline{x})$ существуют целое число $m$ и последовательность $\{ z^{k} \in M \}$ такие, что $z^{k} \in R(x^{k})$ при $k \geq m$ и $z^{k} \to \overline{z}$.
\end{definition}


\begin{definition}
    Отображение $R(x)$ замкнуто в точке $\overline{x} \in K^*$, если $\{ x^{k}\}\subset K^*,\ x^{k} \to \overline{x},\ z^{k} \in R(x^{k}) $, и $z^{k} \to \overline{z}$ влечет  $\overline{z} \in R(\overline{x})$.
\end{definition}


\begin{definition}
    Отображение $R(x)$ непрерывно в точке $\overline{x} \in K^*$, если оно открыто и замкнуто в точке $\overline{x}$. $R$ непрерывно в $K^*$, если $R$ непрерывно для любого $x\in K^*$.
\end{definition}

На основе приведенных определений проверка непрерывности отображения представляется неосуществимой. Однако существуют  достаточные условия непрерывности отображения $R$ на основе свойств функций, задающих ограничения задачи (\ref{1function}).

%теорема
\begin{theorem}\label{1theorem}
     Пусть выполняются следующие условия: 1) $M$ выпукло; 2) все функции $g_{i} (z, x)$ непрерывны на $M \times X$ и выпуклы по $z$ для каждого фиксированного $x \in X$; 3) существует такое $\overline{z}$, что $g(\overline{z}, \overline{x}) < 0$. Тогда $R (x)$ --- непрерывное отображение.
\end{theorem}


\begin{theorem}\label{2theorem}
    Пусть выполняются следующие условия: 1) $M$ выпукло; 2) все функции $g_{i} (z, x)$ непрерывны на $M \times X$ и выпуклы по $z$ и $x$. Тогда $R (x)$ --- непрерывное отображение.
\end{theorem}

Следующие две теоремы дают достаточные условия непрерывности оптимального значения  значения и оптимального плана в задаче (\ref{1function}).

\begin{theorem}\label{3theorem}
    Рассмотрим задачу (\ref{1function}). Если $R (x)$ --- непрерывное отображение и функция $f (z, x)$ непрерывна, то $J^0(x)$, $x\in K^*$ непрерывна.
\end{theorem}


\begin{theorem}\label{4theorem}
    Рассмотрим задачу (\ref{1function}). Пусть выполняются условия: 1) $R (x)$ --- непрерывное отображение; 2) множество $R (x)$ является выпуклым для каждого $x \in K^*$, 2) функция $f (z, x)$ непрерывна и строго квазивыпукла по переменной $z$ для каждого $x$. Тогда $J^0 (x)$ и $z^0 (x)$ --- непрерывные функции.
\end{theorem}

Теоремы \ref{1theorem} и \ref{2theorem} можно объединить с теоремами \ref{3theorem} и \ref{4theorem}, чтобы получить следующие следствия:

%следствие
\begin{corollary}
    Рассмотрим многопараметрическую задачу нелинейного программирования (\ref{1function}). Предположим, что 
    \begin{itemize}
    \item[1)] $M$ --- компактное выпуклое множество в $R^{s}$;
    \item[2)] $f$ и $g$ непрерывны на $M \times \mathbb{R}^{n}$; 
    \item[3)] каждая компонента $g$ выпукла на $M \times K^*$. 
    \end{itemize}
    Тогда функция $J^0 (x)$, $x \in K^*$ непрерывна.
\end{corollary}

\begin{corollary}
   Рассмотрим многопараметрическую задачу нелинейного программирования (\ref{1function}). Предположим, что 
   \begin{itemize}
    \item[1)] $M$ --- компактное выпуклое множество в $R^{s}$; 
    \item[2)] $f$ и $g$ непрерывны на $M \times \mathbb{R}^{n}$; 
    \item[3)] каждая компонента $g$ выпукла на $M$ для каждого $x \in K^*$.
    \end{itemize}
    Тогда $J^0 (x)$ непрерывна в точке $x$, если существует точка $\overline{z}$ такая, что $g (\overline{z}, x) < 0$.
\end{corollary}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Критические области в задаче многопараметрического линейного программирования}\label{2sec:darova}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Рассмотрим многопараметрическую задачу линейного программирования (mp-LP)
\begin{equation}\label{1multy}
    \begin{split}
        & J^0(x) = \min_z J(z,x) = c'z,\\
        % \st 
         & Gz \leq W + Sx,
    \end{split}
\end{equation}
где $z \in \mathbb{R}^s$ --- переменные оптимизации, $x \in \mathbb{R}^{n}$ --- вектор параметров, $J(z, x) \in \mathbb{R}$ --- целевая функция и $G \in \mathbb{R}^{m \times s},\ c \in \mathbb{R}^{s},\ W \in \mathbb{R}^{m}$, и $S \in \mathbb{R}^{m \times n}$. 

Для заданного многогранного множества параметров $K \subset R^{n}$
\begin{equation}\label{2multy}
    K \triangleq \{ x \in \mathbb{R}^{n} : Tx \leq Z \}
\end{equation}
обозначим через $K^* \subseteq K$ --- множество параметров $x \in K$, при которых задача (\ref{1multy}) допустима (имеет решение).

Цель последующего изложения --- определить допустимую область параметров $K^* \subseteq K$, выражения для оптимального значения целевой функции и для одного из оптимальных планов $z^0 (x) \in Z^0 (x)$.

Дадим следующие определения прямой и двойственной невырожденности задачи (\ref{1multy}). Определения приводятся в терминах активных ограничений на некотором плане $z(x)$. Напомним, что ограничение-неравенство $g_i(z,x)$ активно, если оно обращается в равенство: $g_i(z(x),x)=0$.

\begin{definition}
    Для любого заданного $x \in K^*$ задача (\ref{1multy}) называется прямо невырожденной, если существует $z^0 (x) \in Z^0 (x)$ такое, что число активных ограничений на плане $z^0 (x)$ больше, чем число переменных $s$.
\end{definition}

\begin{definition}
    Для любого данного $x \in K^*$ задача (\ref{1multy}) называется двойственно невырожденной, если двойственная ей задача прямо невырождена.
\end{definition}

Многопараметрический анализ основан на понятии критической области (critical region --- CR). 

В \cite{GalNedoma} критическая область определяется как подмножество пространства параметров, на котором некоторый фиксированный базис задачи линейного программирования  является оптимальным. Алгоритм, предложенный в \cite{GalNedoma} для решения mp-LP, генерирует непересекающиеся критические области посредством построения  и исследования графа базисов. На графе базисов вершины представляют собой оптимальные базисы данной многопараметрической задачи, и две вершины соединены ребром, если можно перейти от одного базиса к другому за одну итерацию (в этом случае базисы называются соседними). 

В \cite{Borelli} определение критических областей связано не с базисами, а с набором активных ограничений (см. также \cite{Filippi}).

Пусть $J \triangleq \{1,..., m\}$ --- множество индексов ограничений. Для любого $A \subseteq J$ обозначим через $G_{A}$ и $S_A$ --- подматрицы матриц $G$ и $S$, соответственно, содержащие строки с индексами из $A$,  через $G_{j},\ S_{j}$ и $W_{j}$ --- $j$-ую строку $G$, $S$ и $W$, соответственно.


\begin{definition}
    Оптимальным разбиением $J$, связанным с параметром $x$, назовем пару $(A(x), NA(x))$, где
    $$
        A(x) \triangleq \{ j \in J: G_{j}z^0(x) - S_{j}x = W_{j} \ \forall z^0(x) \in Z^0(x) \},
        $$
    $$
        NA(x) \triangleq \{ j \in J: \exists z^0(x) \in Z^0(x), \ G_{j}z^0(x) - S_{j}x < W_{j}\}.
        $$
\end{definition}

Понятно, что множества $A (x), N A(x)$ не пересекаются и их объединением является множество всех индексов строк $J$. 

Для заданного $x^* \in K^*$ обозначим $(A, NA) \triangleq (A (x^*), N A(x^*) )$, и далее определим множества
\begin{equation}\label{3multy}
    \begin{split}
        & CR_{A} \triangleq \{ x \in K: A(x) = A \},\\
        & \overline{CR}_{A} \triangleq \{ x \in K: A(x) \supseteq A \}.
    \end{split}
\end{equation}
Множество $CR_{A}$ является критической областью, связанной с некоторым фиксированным множеством активных ограничений $A$, т. е. это множество всех параметров $x$, таких что ограничения $i\in A$, активны на оптимальном решении $z^0(x)$  задачи (\ref{1multy}). Ясно, что $\overline{CR}_{A} \supseteq CR_{A}$.


\begin{theorem}\label{5theorem}
    Пусть $(A, NA) \triangleq (A (x^*), NA (x^*))$ для некоторого $x^* \in K$, и пусть $d = \text{dim} (\text{range} G_{A}\bigcap \text{range} S_{A})$. Если $d = 0$, то $CR_{A} = \{x^0\}$. Если $d > 0$, то
    \begin{itemize}
        \item[i)] $CR_{A}$ --- открытый многогранник размерности $d$;
        \item[ii)] $\overline{CR}_{A}$ --- замыкание $CR_{A}$;
        \item[iii)] каждая грань $\overline{CR}_{A}$ есть множество $CR_{A'}$ для некоторой подматрицы $A^{'} \supseteq A$.
    \end{itemize}
\end{theorem}

\begin{remark}
Открытый многогранник --- множество вида $\{x: Px<q\}$, его замыкание --- $\{x: Px\le q\}$.
\end{remark}

Из теоремы \ref{5theorem} и определения критических областей  (\ref{3multy}) следует, что множество $K^*$ всегда \textit{разбивается единственным образом}. Отметим, что это не так в подходе \cite{GalNedoma}, где критическая область определяется на основе базиса решения задачи линейного программирования. Цель дальнейшего изложения --- построение всех полноразмерных критических областей, содержащихся в $K^*$, в соответствии с определением (\ref{3multy}).

Напомним некоторые свойства функции $J^0 (x): \mathbb{R}^{n} \to \mathbb{R}$ и множества $K^*$ из монографии \cite{GalNedoma}. 


\begin{theorem}[\cite{GalNedoma}] \label{6theorem}
    Пусть для фиксированного $x_0 \in K$ существует  оптимальное решение $z^0 (x_0)$ задачи (\ref{1multy}). Тогда для всех $x \in K$ задача (\ref{1multy}) имеет либо имеет решение, либо имеет пустое множество планов.
\end{theorem}

Сформулированная теорема утверждает, что в задаче линейного программирования(\ref{1multy}) либо нет решения (несовместны ограничения), либо решение существует. Третья ситуация --- неограниченность целевой функции снизу --- невозможна.

\begin{theorem}[\cite{GalNedoma}, стр. 179]\label{7theorem} 
    Пусть $K^* \subseteq K$ --- множество всех параметров $x$, таких что задача линейного программирования (\ref{1multy}) имеет  оптимальное решение $z^0 (x)$. Тогда $K^*$ --- замкнутый многогранник в $\mathbb{R}^{n}$.
\end{theorem}

Следующая теорема формулирует свойства, которыми обладает решение в задаче многопараметрического линейного программирования.
\begin{theorem}[\cite{GalNedoma}, стр. 180]\label{8theorem}
    Функция $J^0(x)$, $x\in K^*$, является выпуклой и кусочно-аффинной на $K^*$ (в частности, аффинной в каждой критической области $CR_{A_i}$).

    Если для каждого $x\in K^*$ оптимальное решение $z^0 (x)$ единственно, то функция $z^0(x)$, $x\in K^*$, является непрерывной и кусочно-аффинной. В противном случае (в случае неединственного решения) всегда можно определить непрерывную и кусочно-аффинную функцию решения $z^0 (x) \in Z^0 (x)$, $x\in K^*$.
\end{theorem}


В следующем разделе опишем алгоритм для определения множества $K^*$, его разбиения на полноразмерные критические области $CR_{A_i}$, построения кусочно-аффинных функций оптимального значения $J^0(x)$, $x\in K^*$, и оптимального решения $z^0 (x)$, $x\in K^*$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Алгоритм построения многопараметрического решения}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


Алгоритм состоит из двух основных этапов:
\begin{itemize}
    \item Определить размерность $n' \leq n$ наименьшего аффинного подпространства $\mathcal{K}$, содержащего $K^*$. Если $n^{'} < n$, найти уравнения по $x$, которые определяют $\mathcal{K}$.
        
    \item Определить разбиение $K^*$ на критические области $CR_{A_i}$ и найти функции оптимального значения $J^0(x)$, $x\in K^*$, и оптимального решения $z^0 (x)$, $x\in K^*$.
\end{itemize}

Первый этап --- предварительный, его цель состоит в том, чтобы уменьшить количество параметров и получить полномерную допустимую область параметров. Это облегчает второй этап, который вычисляет многопараметрическое решение и является основой алгоритма mp-LP.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Определение аффинного подпространства $\mathcal{K}$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Для того, чтобы этап 2 работал с минимальной размерностью вектора параметров, первый этап алгоритма нацелен на поиск подпространства $\mathcal{K} \subseteq \mathbb{R}^{n}$, содержащего параметры $x$, при которых задача (\ref{1multy}) допустима (имеет решение).

Первое простое, но важное наблюдение касается числа линейно независимых столбцов матрицы $S$ (обозначим его $r_{S}$). Понятно, что если $r_{S} < n$, то $n - r_{S}$ параметров можно исключить. Поэтому далее без потери общности считаем, что столбцы матрицы $S$ линейно независимы. 

Существует еще один случай, когда размерность вектора параметров может быть понижена. Таким образом, прежде чем решать многопараметрическую задачу, нужен тест для проверки размерности $n'$ наименьшего аффинного подпространства $\mathcal{K}$, содержащего $K^*$. Более того, результатом теста будет $n^{'} < n$, нужно получить уравнения, описывающие $\mathcal{K}$ в $\mathbb{R}^n$. Эти уравнения используются для изменения координат, чтобы уменьшить число параметров с $n$ до $n^{'}$ и получить многогранник $K^*$, который имеет полную размерность в $\mathbb{R}^{n^{'}}$.

Вспомним задачу (\ref{1multy}) и рассмотрим ее как задачу линейного программирования в пространстве $\mathbb{R}^{s + n}$
\begin{equation}\label{11multy}
    \begin{split}
        & \min_z J(z,x) = c'z,\\
        % \st
        & Gz - Sx \leq W.
    \end{split}
\end{equation}
Понятно, что ограничения в (\ref{11multy}) определяют многогранник $\mathcal{P}$ в $\mathbb{R}^{s + n}$. Следующая лемма утверждает, что проекция ${\Pi_{\mathbb{R}^{n}}}(\mathcal{P})$ многогранника $\mathcal{P}$ на пространство параметров $\mathbb{R}^{n}$ есть $K^*$.

\begin{lemma}\label{lemma}
    $x^* \in K^* \Longleftrightarrow \exists z : Gz - Sx^{*} \leq W \Longleftrightarrow x^* \in \Pi_{\mathbb{R}^{n}} (\mathcal{P})$.
\end{lemma}

Как следствие, размерность $n^{'}$ наименьшего аффинного подпространства, содержащего $K^*$, может быть определена путем вычисления размерности проекции $\Pi_{\mathbb{R}^{n}} (\mathcal{P})$.

Пусть задано следующее $H$-представление многогранника: $\mathcal{C} = \{\xi \in \mathbb{R}^s: B\xi \leq \upsilon\}$, т.е. многогранник  $\mathcal{C}$, определяется набором полупространств $B_{i}\xi \leq \upsilon_{i}$.

\begin{definition}
      Действительным неравенством многогранника $\mathcal{C}$ назовем такое неравенство $B_{i}\xi \leq \upsilon_{i}$, что $\exists \overline{\xi} \in \mathcal{C}: B_{i}\overline{\xi} < \upsilon_{i}$.
\end{definition}

Учитывая $H$-представление многогранника $\mathcal{C}$ следующая простая процедура определяет множество $I$ всех недействительных неравенств $\mathcal{C}$.

\bigskip

\begin{algorithm}[H]
    \DontPrintSemicolon
    \SetAlgoLined
    \SetKwInOut{Input}{Input}\SetKwInOut{Output}{Output}
    \Input{многогранник $\mathcal{C}$}
    \Output{Множество $I$ всех недействительных неравенств $\mathcal{C}$}
    \BlankLine
     
    $I \leftarrow \emptyset$    \;
    $M\leftarrow \{1,..., m\}$    \;
    \BlankLine
    \While{$M \neq \emptyset$}{
        
        \BlankLine
        $j \leftarrow$ first element of $\mathcal{M}$\;
        $\mathcal{M} \leftarrow \mathcal{M} \backslash \{j\}$\;
        \BlankLine
        решаем следующую задачу линейного программирования:\;
        $B_{i}\xi \leq v_i, \forall i \in \mathcal{M}$ \;
        \BlankLine
        \If{$B_{i}\xi = v_i$}{
            $I \leftarrow I \cup \{j\}$\;
        }
        \BlankLine
        \For{$h \in \mathcal{M}$} {
            \If{$B_h x^{*} < v_h$}{ \label{alg:1}
                $\mathcal{M} \leftarrow \mathcal{M} \backslash \{h\}$\;
            }
        }
    }
    \caption{}
\end{algorithm}

    % \includegraphics[width=0.6\textwidth]{algorythm1.eps}


\bigskip


\bigskip
Следующий алгоритм описывает стандартную процедуру для определения размерности $n^{'} \leq n$ наименьшего аффинного подпространства $\mathcal{K}$, содержащего $K^*$, и, когда $n^{'} \leq n$, он находит уравнения, определяющие $\mathcal{K}$. 
\bigskip

\begin{algorithm}[H]
    \DontPrintSemicolon
    \SetAlgoLined
    \SetKwInOut{Input}{Input}\SetKwInOut{Output}{Output}
    \Input{матрицы $G, S, W$}
    \Output{Размерность $n^{'} \leq n$ наименьшего аффинного подпространства $\mathcal{K}$, которое содержит $k^{*}$, если $n^{'} \leq n$, такая что $\mathcal{K} = \{ x \in \mathbb{R}^{n}  \ Tx = Z \}$}
    \BlankLine
    Отбрасываем истинные неравенства из ограничений \ref{alg:1}\;
    \eIf{никакого неравнества не осталось} {
        $\mathcal{K} \leftarrow \mathbb{R}^{n}$
    }
    {
        Разрешим $\mathcal{P}_a \triangleq \{ (z,x) : G_{a}z - S_{a}x = W_a\}$ 
        быть полученным аффинным подпространством, полученным путем сбора не истинных неравенств\;
        $\{u_1,...,u_{k^{'}}\}$ - базис ядра $G_{a}^{'}$\;
        \uIf{$k^{'} = 0$} {
            $\Pi_{\mathbb{R}^{n}}(\mathcal{P}_a)$ и $K^*$ полноразмерны\;
            $\mathcal{K} \leftarrow \mathbb{R}^{n}$
        }
        \Else {
            $\mathcal{K} \leftarrow \{ x\ |\ Tx = Z \}$, где \;
            $$
                T = - \begin{bmatrix}
                    u_{1}^{'} \\
                    \vdots \\
                    u_{k^{'}}^{'}
                  \end{bmatrix} S_a,\ Z = \begin{bmatrix}
                    u_{1}^{'} \\
                    \vdots \\
                    u_{k^{'}}^{'}
                  \end{bmatrix} W_a
            $$
        }
    }
    \caption{}
\end{algorithm}

\bigskip

С учетом приведенных алгоритмов, в дальнейшем, не теряя общности, будем предполагать, что множество $K$ имеет размерность $n$ в $\mathbb{R}^n$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Определение критических областей}\label{critical-regions}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

В этом разделе приведем детали алгоритма mp-LP, а именно процедуру построения критических областей $CR_{A_i}$ в заданном многогранном множестве $K$. Далее будем считать, что все задачи линейного программирования являются прямо и двойственно невырожденными. Описание вырожденных случаев можно найти в работе \cite{Borelli}.

В силу невырожденности задач, для каждого значения параметра $x\in K^*$ имеется единственное оптимальное решение $z^0(x)$, т.е. $Z^0 (x) = \{z^0 (x)\}$,  $x\in K^*$. 

В алгоритме используются: 
\begin{itemize}
\item прямая допустимость для получения $H$-представления полиэдральных критических областей, 
\item условия дополняющей нежесткости для вычисления функции оптимального решения $z^0 (x)$, $x\in K^*$, 
\item двойственная задача для получения функции оптимального значения $J^0 (x)$, $x\in K^*$. 
\end{itemize}    
    
Двойственная задача для (\ref{1multy}) имеет вид
\begin{equation}\label{1critical}
    \begin{split}
       & \max_y(W + Sx)'y,\\
    %    \st 
       & G'y = c,\\ 
           & y \leq 0.
    \end{split}
\end{equation}

Прямая и двойственная допустимость и условия дополняющей нежесткости для задач (\ref{1multy}), (\ref{1critical}) имеют вид
\begin{equation}\label{11critical}
    \begin{split}
            \text{прямая допустимость:} & \ Gz \leq W + Sx, \\
            \text{двойственная допустимость:} & \ G'y = c,\ y \leq 0, \\
            \text{условия доп. нежесткости:} & \ (G_{j}z - W_j - S_{j}x)y_i = 0, \ j \in J.
        \end{split}
    \end{equation}


Выберем произвольный вектор параметров $x_0 \in \mathcal{K}$ и решим прямую и двойственную задачи (\ref{1multy}), (\ref{1critical}) для $x = x_0$. Пусть $z^0_0$ и $y^0_0$ --- решения прямой и двойственной задач, соответственно. Значение $z^0_0$ определяет следующее оптимальное разбиение
\begin{equation}\label{2critical}
    \begin{split}
        A(x_0) \triangleq \{ j \in J: G_{j}z^0_0 - S_{j}x_0 - W_j = 0 \}\\
        NA(x_0) \triangleq \{ j \in J: G_{j}z^0_0 - S_{j}x_0 - W_j < 0 \}\\
    \end{split}
\end{equation}
и, следовательно, критическую область $CR_{A (x_0)}$.

По предположению решение $y^0_0$ единственно, а по определению критической области значение $y^0_0$ остается оптимальным для всех $x \in CR_{A (x_0)}$. Тогда, согласно теореме двойственности, функция оптимального значения в $CR_{A (x_0)}$ определяется как
\begin{equation}\label{3critical}
   J^0(x) = (W + Sx)'y^0_0, \ x\in CR_{A (x_0)},
\end{equation}
и является аффинной функцией $x$ на $CR_{A (x_0)}$, как указано в теореме \ref{8theorem}. 

Более того, для оптимального разбиения (\ref{2critical}) условие прямой допустимости можно переписать в виде:
\begin{equation}\label{4critical-a}
    G_{A}z^0(x) = W_A + S_{A}x,   
    \end{equation}
\begin{equation}\label{4critical-b}
    G_{NA}z^0(x) < W_NA + S_{N A}x.
    \end{equation}
В отсутствие двойственной невырожденности прямое решение единственно, и система (\ref{4critical-a}) может быть решена, чтобы получить решение $z^0 (x)$. Фактически, уравнения (\ref{4critical-a}) образуют систему из $l$ равенств, где в отсутствие прямой невырожденности $l = s$ --- число активных ограничений. Из (\ref{4critical-a}) следует, что
\begin{equation}\label{z0}
    z^0(x) = -G^{-1}_{A} S_{A} x + G_{A}^{-1}W_A = Ex + Q,
\end{equation}
откуда следует линейность $z^0$ по $x$. 

Из условия прямой допустимости (\ref{4critical-b}) получаем следующее представление критической области $CR_{A (x_0)}$
\begin{equation}\label{CR}
    G_{NA}(Ex + Q) < W_{NA} + S_{NA}x.
\end{equation}
Ее замыкание $\overline{CR}_{A (x_0)}$ имеет вид $G_{NA}(Ex + Q) \le W_{NA} + S_{NA}x$.

После определения критической области $\overline{CR}_{A (x_0)}$ необходимо исследовать оставшуюся часть пространства $R^{\text{rest}} = K \ \backslash \ \overline{CR}_{A (x_0)}$ и создать новые критические области.

Эффективный подход к разбиению остального пространства был предложен в \cite{Dua57} и формально доказан в \cite{Bemporad25}. Далее сформулируем теорему, которая обосновывает процедуру формирования остальных критических областей.
\begin{theorem}\label{9theorem}
    Пусть $Y \subseteq \mathbb{R}^n$ --- многогранник,  $R_0 \triangleq \{x \in Y: Ax \leq b\}$ --- полиэдральное подмножество $Y$, где $b \in R^{m \times 1},\  R_0 \not = \emptyset$. Пусть
    $$
    R_i =
    \left\{x \in Y:  \begin{array}{l}
        A^{i}x > b^i\\
        A^{j}x \leq b^{j},\ j < i
        \end{array}
    \right\}, \ \   i = 1,...,m, 
    $$
    где $b \in \mathbb{R}^{m \times 1}$ и пусть $R^{\text{rest}} \triangleq \bigcup^{m}_{i=1} R_i$.
    
    Тогда \begin{itemize}
    \item[i)] $R^{\text{rest}} \cup R_0 = Y$,
    \item[ii)] $R_0 \cap R_i = \emptyset,\ R_i \cap R_j = \emptyset,\ \forall i \not = j$,
    \end{itemize}
    т.е. $\{R_0, R_1, \ldots, R_m\}$ --- разбиение $Y$.
\end{theorem}

\begin{proof}
    i) Нужно доказать, что точка $x \in Y$ либо принадлежит $R_0$, либо принадлежит $R_i$ для некоторого $i$. Если $x \in R_0$, то результат очевиден. В противном случае, существует такой индекс $i$, что $A^{i} x > b^i$. Пусть $i^* = \min_{i \leq m} \{ i: A^{i}x > b^{i} \}$. Тогда $x \in R_{i^*}$, поскольку $A^{i^{*}} x > b^{i^{*}}$ и $A^{j} x \leq b^{j},\ \forall j < i^*$, по определению $i^*$.

    ii) Пусть $x \in R_0.$ Тогда не существует ни одного $i$ такого, что $A^{i} x > b^i$, из чего следует, что $x \not\in R_i,\  \forall i \leq m$. Пусть $x \in R_i$ и возьмем $i > j$. Поскольку $x \in R_i$, по определению $R_{i} (i > j)$ имеем $A^{j}x \leq b^j$, из чего следует, что $x \not \in R_j$.
\end{proof}



% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \subsection{Результаты mp-LP алгоритма}
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Основываясь на приведенном выше обсуждении, решение mp-LP может быть обобщено в следующем алгоритме (\ref{critical-regions}). Обратите внимание, что алгоритм генерирует разбиение пространства состояний в широком смысле. Алгоритм может быть модифицирован для хранения критических областей, как это определено в (\ref{5theorem}), которые являются открытыми наборами, вместо хранения его замыкания. В этом случае алгоритм должен исследовать и хранить все критические области, которые не являются полноразмерными, чтобы создать разделение множества возможных параметров. С практической точки зрения такая процедура не является необходимой, поскольку функция значения и оптимизатор являются непрерывными функциями от $x$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Multi-Parametric Toolbox}\label{2sec:problem-formulation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Multi-Parametric Toolbox (или MPT) --- это набор инструментов на основе Matlab с открытым исходным кодом для параметрической оптимизации и вычислительной геометрии.
Инструментарий предлагает широкий спектр алгоритмов, скомпилированных в удобном и доступном для пользователя формате.
Полученные в результате законы оптимального управления могут быть встроены в приложения в виде кода на C или развернуты на целевых платформах с использованием Real Time Workshop.

Cуществуют наборы инструментов, которые предлагают операции, связанные исключительно с вычислительной геометрией, то есть наборы инструментов GEOMETRY, CGLAB и Ellipsoidal Toolbox. Другие наборы инструментов помимо геометрических предлагают также алгоритмы для вычисления и реализации процедур управления, например набор инструментов Hybrid, MOBY-DIC, RACT, PnPMPC и RoMulOC. MPT также является одним из инструментов, который сочетает вычислительную геометрию с методами управления. Многие из этих наборов инструментов, включая MPT, используют YALMIP, который обеспечивает язык высокого уровня для моделирования и формулирования задач оптимизации.
\\
Содержание MPT можно разделить на четыре модуля:
\begin{itemize}
    \item Моделирование динамических систем
    \item MPC на основе синтеза
    \item Анализ решения с обратной связью
    \item Развертывание регуляторов MPC на аппаратном уровне
\end{itemize}

Каждая часть представляет собой один этап в разработке и реализации явного MPC. Модуль моделирования MPT позволяет описывать системы с дискретным временем с линейной динамикой. Модуль управления позволяет формулировать и решать ограниченные задачи оптимального управления для линейных систем c ограничениями. Модуль анализа предоставляет методы для исследования поведения и производительности замкнутого контура. Кроме того, он также содержит методы, позволяющие уменьшить сложность явных обратных связей MPC.

\bigskip

%%%%
Рассмотрим самые важные возможности, которые предоставляет MPT:
\begin{enumerate}
\item Набор инструментов Matlab для применения явного MPC
% \begin{itemize}
%     \item 
%     \item 
%     \item 
%     \item 
% \end{itemize}
\begin{itemize}
    \item Реализация MPC в режиме реального времени
\end{itemize}
\item Подходы
\begin{itemize}
    \item Автономно: решить задачу оптимального управления параметрически
    \item Онлайн: оценить полученную обратную связь (рис. \ref{2-img-1})
\end{itemize}

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.8\textwidth]{course-img.eps}
    \caption{Отображение подхода}
    \label{2-img-1}
  \end{figure}



\item Расширенная поддержка многогранников

неограниченные, низкоразмерные множества (рис. \ref{2-img-2})\\
P = Polyhedron(’A, A, ’b’, b, ’Ae’, Ae, ’be’, be) \\
Q = Polyhedron(’V’, V, ’R’, R)

\begin{figure}[h!]
    \centering
    \includegraphics[width=1\textwidth]{mpt-9.eps}
    \caption{Неограниченные, низкоразмерные множества}
    \label{2-img-2}
  \end{figure}


объединение многогранников с определенными свойствами (рис. \ref{2-img-3})\\
U = PolyUnion(’Set’, P, ’Convex’, 1, ’Overlaps’, 0)

\begin{figure}[h!]
    \centering
    \includegraphics[width=1\textwidth]{mpt-4.eps}
    \caption{Объединение многогранников}
    \label{2-img-3}
  \end{figure}


\bigskip
\item Поддерживаемые геометрические операции


Cумма Минковского (рис.  \ref{2-img-4}), разность Понтрягина (рис.  \ref{2-img-5}), проекции, разности множеств и т.д.

$S = P + Q$ \\
\begin{figure}[h!]
    \centering
    \includegraphics[width=1\textwidth]{mpt-3.eps}
    \caption{Cумма Минковского}
    \label{2-img-4}
  \end{figure}

$T = U \backslash S$ \\
\begin{figure}[h!]
    \centering
    \includegraphics[width=1\textwidth]{mpt-2.eps}
    \caption{Разность Понтрягина}
    \label{2-img-5}
  \end{figure}

\bigskip

\item Генерация явного решения

\begin{itemize}
\item Построить объект регулятора MPC онлайн

$ctrl = MPCController(model, N)$ \\
$u = ctrl.evaluate(x)$



\item Настроить регулятор и закончить цикл

$loop = ClosedLoop(ctrl, model)$ \\
$data = loop.simulate(x_0, Nsim)$


\item Экспорт в явную форму

$expl_{ctrl} = ctrl.toExplicit()$ \\

Наглядно данный алгоритм проиллюстрирован на рисунке \ref{fig:alg}
\begin{figure}[!ht]
    \centering
    \includegraphics[width=0.4\textwidth]{mpt-5.eps}
    \caption{Алгоритм}
    \label{fig:alg}
\end{figure}

\end{itemize}
\end{enumerate}

\bigskip
\subsection{2D Пример осциллятора}

\begin{itemize}
\item Функция стоимости \\
$expl_{ctrl}.cost.fplot()$\ (Рисунок \ref{fig:2d-func}) \\
\begin{figure}[h]
    \centering
    \includegraphics[width=0.4\textwidth]{mpt8.eps}
    \caption{Функция стоимости}
    \label{fig:2d-func}
\end{figure}

\item Закон обратной связи \\
$expl_{ctrl}.feedback.fplot()$\ (Рисунок \ref{fig:2d-zos})\\
\begin{figure}[h]
    \centering
    \includegraphics[width=0.3\textwidth]{mpt-7.eps}
    \caption{Закон обратной связи}
    \label{fig:2d-zos}
\end{figure}


\item Область \\
$expl_{ctrl}.partition.plot()$\ (Рисунок \ref{fig:2d-obl})\\
\begin{figure}[!ht]
    \centering
    \includegraphics[width=0.35\textwidth]{mpt-6.eps}
    \caption{Область}
    \label{fig:2d-obl}
\end{figure}

\end{itemize}

\subsection{Единый "солвер" для параметрических задач}
MPT может быть очень полезен в решении параметрических задач. Ниже приведен пример решения такой задачи. \\
$$
\min 1/2 u^THu + c^Tu\\
Au \le b + E\xi,\ u \ge 0
$$
$$\Downarrow$$
$$
Hu + c + A^T\lambda - \upsilon = 0\\
Au \le b + E\xi,\ u \ge 0\\
\lambda^T(Au - b - E\xi) = 0,\ \upsilon^Tu = 0\\
$$
$$\Downarrow$$
Найти $w$, $z$
$$
w - Mz = q + G\xi\\
w \ge 0, \ z\ge 0 \\
w^Tz = 0
$$
$$\Downarrow$$

\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{parametric-img.eps}
    \caption{Результат}
    \label{fig:param-res}
\end{figure}
Резултат выполнения программы показан на рисунке \ref{fig:param-res} \\

%%%
Целью Multi-Parametric Toolbox (MPT) является предоставление эффективных вычислительных
средства для получения регуляторов обратной связи для типов задач оптимального управления
в среде программирования Matlab. Многопараметрическим программированием, линейным или
задачи квадратичной оптимизации решается в автономном режиме. Соответствующее решение принимает форму кусочно-непрерывной
обратной связи. В частности, пространство состояний разбивается на многогранные множества и
для каждого из этих наборов закон оптимального управления задается как одна аффинная функция.
Для квадратичных задач, регулятор обратной связи может быть получен для ограниченных
линейных системы с применением методов многопараметрического программирования.
Несмотря на то, что многопараметрические подходы основаны на автономном вычислении закона обратной связи,
вычисление может быстро стать препятствующим для больших проблем. Это связано не только
высокой сложностью многопараметрических программ, но в основном из-за
экспоненциального количества переходов между регионами, которые могут произойти, когда регулятор
вычисляется в режиме динамического программирования.

\bigskip
Итак, Multi-Parametric Toolbox --- это набор алгоритмов для моделирования, управления, анализа и развертывания ограниченных оптимальных регуляторов, разработанных в Matlab. Он обладает мощной геометрической библиотекой, которая расширяет возможности применения набора инструментов за пределы оптимального управления для различных задач, возникающих в вычислительной геометрии.